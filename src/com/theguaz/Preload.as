package com.theguaz {	import flash.display.*;	import flash.events.*;	import flash.net.*;		import flash.external.ExternalInterface;		import com.greensock.TweenMax; 		import com.facebook.graph.Facebook;		public class Preload extends MovieClip{					private var _ldr:Loader;		private static const APP_ID:String = "110759525760819"; //Place your application id here		private static const SCOPE:String = "user_about_me, publish_stream, email, user_location";		private static const APP_URL:String = "http://apps.facebook.com/powerade-wristaband"			private var _topURL:String;		private var _rfid:String;				private var _fbid:String;		private var _nameMe:String;		private var _email:String		private var _profile:String				public function Preload():void{			alpha = 0; visible = false; 			this.loaderInfo.addEventListener(Event.COMPLETE, configUI);		}				private function configUI(e:Event):void{				if(this.loaderInfo.parameters.rfid){				_rfid = String(this.loaderInfo.parameters.rfid);			}			load_mc.alpha = 0; load_mc.visible = false;			_topURL = ExternalInterface.call("top.location.toString");			addEventListener(Event.ADDED_TO_STAGE, configUI);			Facebook.init(APP_ID, onLogin);					stage.scaleMode = StageScaleMode.NO_SCALE;			stage.align = StageAlign.TOP_LEFT;			this.loaderInfo.removeEventListener(Event.COMPLETE, configUI);		}				private function successfulLogin():void{			//loadSite();			loadMe();		}				private function loadMe():void {			Facebook.api('/me/', handleMeLoad);		}				private function handleMeLoad(response:Object, fail:Object):void {			if(response){				_fbid = String(response.id);				_nameMe = String(response.name);				_email = String(response.email);				_profile = String(response.link);			}			saveMe();		}				public function saveMe():void{			var urlVars:URLVariables = new URLVariables();			urlVars.fbid =  _fbid;			urlVars.rfid = _rfid;						var request:URLRequest = new URLRequest ("update.php");			request.method = URLRequestMethod.POST;			request.data = urlVars;			var loader:URLLoader = new URLLoader (request);			loader.addEventListener(Event.COMPLETE, onCompleteConsult);			loader.dataFormat = URLLoaderDataFormat.TEXT;			loader.load(request);		}				public function onCompleteConsult(event:Event):void{			var stat = event.target.data;			ExternalInterface.call("console.log", stat);			TweenMax.to(this, .5, {autoAlpha:1});		}				private function unSuccessfulLogin():void{					}				private function onLogin(result:Object, fail:Object):void {				if(_rfid != null){				//rfid_txt.text = "RFID: " + _rfid;			}			 if (result){               successfulLogin();			               }else{				if(_topURL){					unSuccessfulLogin();				}else{					ExternalInterface.call("redirect", APP_ID, SCOPE, APP_URL);				}			}		}				private function handleLoginClick():void {			var opts:Object = {scope:SCOPE};			Facebook.login(onLogin, opts);		}			private function onLogout(success:Boolean):void {								}				private function loadSite():void{						load_mc.alpha = 0;			_ldr = new Loader();			_ldr.load(new URLRequest("Main.swf"));			_ldr.contentLoaderInfo.addEventListener(Event.COMPLETE, completeMe);			_ldr.contentLoaderInfo.addEventListener(ProgressEvent.PROGRESS, progressMe);			TweenMax.to(load_mc, .75,{alpha:1})		}				private function progressMe(e:ProgressEvent):void{			var per:Number = Math.round(e.bytesLoaded  * 100 / e.bytesTotal);			load_mc.perc_txt.text = per + "%"		}				private function completeMe(e:Event):void{				_ldr.contentLoaderInfo.removeEventListener(Event.COMPLETE, completeMe);			_ldr.contentLoaderInfo.removeEventListener(ProgressEvent.PROGRESS, progressMe);			TweenMax.to(load_mc, .75, {autoAlpha:0, onComplete:initSite})			e.currentTarget.content.rfid = _rfid;		}				private function initSite():void{			_ldr.content.alpha = 0; _ldr.content.visible = false;			addChild(_ldr.content);			TweenMax.to(_ldr.content, .5, {autoAlpha:1});		}			}}