package com.theguaz {		import flash.display.*;    import flash.events.*;    import flash.external.*;    import flash.system.*;    import flash.text.*;    import flash.utils.*;	import flash.net.*;	import flash.ui.*;		import com.bit101.components.PushButton;	import com.bit101.components.InputText;	import com.bit101.components.TextArea;		import com.quetwo.Arduino.ArduinoConnector;	import com.quetwo.Arduino.ArduinoConnectorEvent	import flash.desktop.NativeApplication;		//import com.facebook.graph.FacebookDesktop		import com.greensock.*; 	import com.greensock.easing.*;	import com.greensock.plugins.*;		public class Main extends MovieClip {				private var _ref:MovieClip;		private var _arduino:ArduinoConnector;		private var _serverPHP:String = "http://www.appsbond.cl/powerade/tabs/test-rfid/";		private var _rfid:String				private var _textArea:TextArea;				public var inputSend:TextField;				public function Main() {			addEventListener(Event.ADDED_TO_STAGE, setupUI);		}				private function setupUI(e:Event):void{			_ref = this;			removeEventListener(Event.ADDED_TO_STAGE, setupUI);						_textArea = new TextArea(_ref, 20, 80, "trace");			_textArea.y = stage.stageHeight - _textArea.height - 10;			_textArea.visible = false;			inputSend.restrict = "a-z A-Z 0-9 @ _ - .";			inputSend.addEventListener(FocusEvent.FOCUS_IN, onFocusIn);			inputSend.addEventListener(FocusEvent.FOCUS_OUT, onFocusOut);			initArduino();		}				private function onFocusIn(e:FocusEvent):void{			if(inputSend.text == "usuario@powerade.cl" || inputSend.text == ""){				inputSend.text  = "";			}		}				private function onFocusOut(e:FocusEvent):void{			if(inputSend.text == ""){				inputSend.text  = "usuario@powerade.cl";			}		}				private function onPushButtonEventHandler(e:Event):void{			fromRFID();		}				private function onInputTextEventHandler(e:Event):void{					}				private function initArduino():void{        	_arduino = new ArduinoConnector();			var ports:Array = _arduino.getComPorts();        	_arduino.connect(ports[0], 9600);			_arduino.addEventListener("socketData", onArduinoSocketDataHandler);			NativeApplication.nativeApplication.addEventListener(Event.EXITING, closeApp);			_textArea.text  = ports.toString();		}				private function onArduinoSocketDataHandler(e:Event):void{			if(_arduino){									var str:String = String(_arduino.readBytesAsString());					if(str.length == 16){						fromRFID(str.substr(1, 12));					}					_textArea.text = str + "// largo: " + str.length;							}		}				private function randomRange( min:Number, max:Number ):Number{			return (min +(Math.random() * (max- min)));  		}				private function fromRFID(id:String = "39008588AB9F"):void{			_rfid = id;			var urlVars:URLVariables = new URLVariables();			urlVars.rfid =  _rfid;			if(inputSend.text == "usuario@powerade.cl"){				urlVars.email_to = "luis@theguaz.com";			}else{				urlVars.email_to = inputSend.text;			}						var request:URLRequest = new URLRequest (_serverPHP + "save.php");			request.method = URLRequestMethod.POST;			request.data = urlVars;			var loader:URLLoader = new URLLoader (request);			loader.addEventListener(Event.COMPLETE, onCompleteConsult);			loader.dataFormat = URLLoaderDataFormat.TEXT;			loader.load(request);			_textArea.text = "sending to " + urlVars.email_to;			inputSend.alpha = 0; inputSend.visible = false;			bgText_mc.alpha = 0; bgText_mc.visible = false;		}				private function onCompleteConsult(e:Event):void{			_textArea.text = "email sent..." + e.target.data;			TweenMax.to(bgText_mc, 1, {autoAalpha:1, delay:1.7});			TweenMax.to(inputSend, 1, {autoAalpha:1, delay:1.7});			inputSend.text = "usuario@powerade.cl";			_rfid = null;		}				private function closeApp(event:Event):void{			if(_arduino){        		_arduino.dispose();        			}		}								///////////// END OF CLASS ///////////// 	}	}